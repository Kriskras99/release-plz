"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[8270],{2375:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>d,frontMatter:()=>a,metadata:()=>i,toc:()=>c});var r=s(4848),t=s(8453);const a={},l="release-pr",i={id:"usage/release-pr",title:"release-pr",description:"The release-plz release-pr command runs release-plz update and",source:"@site/docs/usage/release-pr.md",sourceDirName:"usage",slug:"/usage/release-pr",permalink:"/docs/usage/release-pr",draft:!1,unlisted:!1,editUrl:"https://github.com/MarcoIeni/release-plz/tree/main/website/docs/usage/release-pr.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"update",permalink:"/docs/usage/update"},next:{title:"release",permalink:"/docs/usage/release"}},o={},c=[{value:"PR update",id:"pr-update",level:2},{value:"Gitea",id:"gitea",level:2},{value:"Github",id:"github",level:2},{value:"Json output",id:"json-output",level:2}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"release-pr",children:"release-pr"})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"release-plz release-pr"})," command runs ",(0,r.jsx)(n.a,{href:"/docs/usage/update",children:(0,r.jsx)(n.code,{children:"release-plz update"})})," and\nopens a GitHub Pull Request that prepares the next release."]}),"\n",(0,r.jsx)(n.p,{children:"When the project maintainer merges the release pull request, the packages are\nready to be published."}),"\n",(0,r.jsxs)(n.p,{children:["Here's an example of a ",(0,r.jsx)(n.a,{href:"https://github.com/MarcoIeni/release-plz/pull/377",children:"PR"}),"\nopened by release-plz in the release-plz GitHub project itself."]}),"\n",(0,r.jsxs)(n.p,{children:["In the following example, I run ",(0,r.jsx)(n.code,{children:"release-plz"})," on the ",(0,r.jsx)(n.code,{children:"release-plz"})," project\nitself.\n",(0,r.jsx)(n.code,{children:"Release-plz"})," opens a PR that increases the version and the changelog of the\npackages with unpublished changes."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:"https://user-images.githubusercontent.com/11428655/160772903-544c7578-7c17-4311-b6ca-a1aefeabe799.gif",alt:"release-plz release-pr"})}),"\n",(0,r.jsxs)(n.p,{children:["To learn more, run ",(0,r.jsx)(n.code,{children:"release-plz release-pr --help"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"pr-update",children:"PR update"}),"\n",(0,r.jsx)(n.p,{children:"If there's already an open release PR:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"If the PR contains commits that are not from bots (except the first one),\nrelease-plz closes the PR to preserve the git history.\nThe update mechanism is simple: overwrite everything and force-push. \ud83d\udca5\nReasoning: changes done by bots are not valuable, so we can overwrite them.\n(Not available on Gitea)."}),"\n",(0,r.jsx)(n.li,{children:"Otherwise, release-plz closes the old PR and opens a new one.\nThis is done to preserve the git history of maintainers' changes.\nRelease-plz also closes the release PR when it cannot update it\n(for example, the force-push fails due to merge conflicts)."}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"release-plz release-pr -p <package>"})," doesn't open a PR per package.\nInstead, release-plz overrides the existing release PR with the changes of the specified package."]})}),"\n",(0,r.jsx)(n.h2,{id:"gitea",children:"Gitea"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"release-plz release-pr"})," also supports creating PRs for repositories hosted on\nGitea with the ",(0,r.jsx)(n.code,{children:"--backend"})," flag:"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"release-plz release-pr --git-token <gitea application token> --backend gitea"})}),"\n",(0,r.jsx)(n.h2,{id:"github",children:"Github"}),"\n",(0,r.jsxs)(n.p,{children:["On Github, the ",(0,r.jsx)(n.code,{children:"release-plz release-pr"})," will use your ",(0,r.jsx)(n.code,{children:"--git-token"})," to create a commit\nthrough the ",(0,r.jsx)(n.a,{href:"https://docs.github.com/en/graphql",children:"GraphQL API"})," rather\nthan making a commit locally and pushing the changes.\nThis allows having a ",(0,r.jsx)(n.a,{href:"https://docs.github.com/en/authentication/managing-commit-signature-verification/about-commit-signature-verification",children:"Verified"}),"\ncommit without specifying a GPG signature."]}),"\n",(0,r.jsx)(n.h2,{id:"json-output",children:"Json output"}),"\n",(0,r.jsxs)(n.p,{children:["You can get info about the outcome of this command by appending ",(0,r.jsx)(n.code,{children:"-o json"})," to the command:\nStdout will contain info about the release PR:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "prs": [\n    {\n      "head_branch": "<head_branch>",\n      "base_branch": "<base_branch>",\n      "html_url": "<html_url>",\n      "number": <pr_number>\n    }\n  ]\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "prs": [\n    {\n      "head_branch": "release-plz-2024-04-03T21-57-37Z",\n      "base_branch": "main",\n      "html_url": "http://localhost:3000/zodpwlgr/xcpayeoa/pulls/1",\n      "number": 1\n    }\n  ]\n}\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"prs"}),": An array of objects representing the opened PRs.\nIf release-plz didn't open or update a release PR, the ",(0,r.jsx)(n.code,{children:"prs"})," array will be empty."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"head_branch"}),": The name of the branch where the changes are implemented."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"base_branch"}),": name of the branch the changes are pulled into.\nIt is the default branch of the repository. E.g. ",(0,r.jsx)(n.code,{children:"main"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["At the moment, the ",(0,r.jsx)(n.code,{children:"release-plz release-pr"})," command doesn't support opening multiple PRs, but we\nplan to add this feature in the future."]})})]})}function d(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>i});var r=s(6540);const t={},a=r.createContext(t);function l(e){const n=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),r.createElement(a.Provider,{value:n},e.children)}}}]);